<mat-card class="filtros-card">
  <mat-card-content>

    <!-- Fila superior: tÃ­tulo + botÃ³n -->
    <div class="header-row">
      <h2 class="titulo">Compras Cerradas</h2>
      <button mat-raised-button color="primary" (click)="abrirDialogoNuevaCompra()">
        + AÃ±adir compra
      </button>
    </div>

    <!-- Fila inferior: botones de moneda + buscador -->
    <div class="filtros-row">

      <!-- Botones de moneda -->
      <mat-button-toggle-group 
        [(ngModel)]="monedaFiltro" 
        (change)="seleccionarMoneda(monedaFiltro)" 
        class="moneda-toggle-group"
        appearance="standard"
        color="primary">

        <mat-button-toggle value="TODOS">Todos</mat-button-toggle>
        <mat-button-toggle value="USD">USD</mat-button-toggle>
        <mat-button-toggle value="BOB">BOB</mat-button-toggle>
      </mat-button-toggle-group>

      <!-- Buscar proveedor -->
      <mat-form-field appearance="outline" class="filtro-item">
        <mat-label>Buscar proveedor</mat-label>
        <input matInput [(ngModel)]="proveedorFiltro" (input)="buscarProveedor($event)">
        <button *ngIf="proveedorFiltro" matSuffix mat-icon-button aria-label="Clear" (click)="proveedorFiltro=''">
          <mat-icon>close</mat-icon>
        </button>
      </mat-form-field>

    </div>

  </mat-card-content>
</mat-card>



<mat-accordion class="custom-accordion" multi>
  <mat-expansion-panel *ngFor="let compra of comprasFiltradas" class="compra-panel">

    <!-- Header -->
 <mat-expansion-panel-header class="custom-header">
  <mat-panel-title class="panel-left">
    <mat-icon color="primary" class="icono-compra">store</mat-icon>
    {{ compra.proveedor.nombre }}
    <span class="fecha">ðŸ“… {{ compra.fecha | date:'shortDate'}}</span>
  </mat-panel-title>

  <mat-panel-description class="panel-right">
    <span class="precio-unit">
      Unit: {{ compra.precioUnit | number:'1.2-2' }}
      <span [ngClass]="compra.moneda">{{ compra.moneda }}</span>
    </span>
    <span class="costo-total">
      Total: {{ compra.montoUSD | number:'1.2-2' }}
      <span [ngClass]="compra.moneda">{{ compra.moneda }}</span>
    </span>
  </mat-panel-description>
</mat-expansion-panel-header>


    <!-- Contenido -->
    <div class="contenido-compra">
      <h3 class="barras-title">InformaciÃ³n de las barras</h3>

      <table mat-table [dataSource]="compra.barras" class="mat-elevation-z2 inner-table">

        <!-- Peso -->
        <ng-container matColumnDef="pesoGr">
          <th mat-header-cell *matHeaderCellDef>Peso (gr)</th>
          <td mat-cell *matCellDef="let barra">{{ barra.pesoGr }}</td>
        </ng-container>

        <!-- Pureza -->
        <ng-container matColumnDef="pureza">
          <th mat-header-cell *matHeaderCellDef>Pureza</th>
          <td mat-cell *matCellDef="let barra">{{ barra.pureza }}</td>
        </ng-container>

        <!-- Peso Fino -->
        <ng-container matColumnDef="pesoFino">
          <th mat-header-cell *matHeaderCellDef>Peso Fino</th>
          <td mat-cell *matCellDef="let barra">{{ barra.pesoFino }}</td>
        </ng-container>

        <!-- Onzas -->
        <ng-container matColumnDef="onzas">
          <th mat-header-cell *matHeaderCellDef>Onzas</th>
          <td mat-cell *matCellDef="let barra">{{ barra.onzas }}</td>
        </ng-container>

        <!-- Precio Unitario -->
        <ng-container matColumnDef="precioUnit">
          <th mat-header-cell *matHeaderCellDef>Precio Unit.</th>
          <td mat-cell *matCellDef="let barra">{{ barra.precioUnit | currency: compra.moneda }}</td>
        </ng-container>

        <!-- Monto Total -->
        <ng-container matColumnDef="montoTotal">
          <th mat-header-cell *matHeaderCellDef>Monto Total</th>
          <td mat-cell *matCellDef="let barra">{{ barra.montoTotal | currency: compra.moneda }}</td>
        </ng-container>

        <!-- Rows -->
        <tr mat-header-row *matHeaderRowDef="['pesoGr','pureza','pesoFino','onzas','precioUnit','montoTotal']"></tr>
        <tr mat-row *matRowDef="let row; columns: ['pesoGr','pureza','pesoFino','onzas','precioUnit','montoTotal'];"></tr>
      </table>
    </div>
  </mat-expansion-panel>
</mat-accordion>
